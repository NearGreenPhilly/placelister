<html>
{% include 'listr/base.html' %}

<head>

    <script src="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />

    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places&key=AIzaSyCUSkUaTU4DJhuheYoh3_x2y1BBD40N3yc"></script>




</head>


<style>
    #thamap { height: 600px; }
</style>

<body>
{% block content %}
    <div class="col-sm-4">
    <ul>
        {% for c in clist %}
        <h2>Places in {{ c.name }}</h2>
        {% endfor %}
        {% for p in places %}
            <li>{{ p.name }}</li>
        {% endfor %}
    </ul>

    <br>



    <div class="col-sm-12">
        <form id="place_form" method="post" action={% url 'place_list' listid %}>
                {% csrf_token %}
            <input id="searchTextField" name="searchTextField" type="text" size="45">
            <button type="submit" class="btn btn-primary">Add</button>
        </form>
    </div>

    </div>


    <div class="col-sm-8">
            <div id="thamap">

            </div>

    </div>

{% endblock %}

<script>

    function initialize() {

        var input = document.getElementById('searchTextField');

        var autocomplete = new google.maps.places.Autocomplete(input);
        }

    google.maps.event.addDomListener(window, 'load', initialize);


    var geoj = {{geoj|safe}}


    var mymap = L.map('thamap').setView([39, -77], 11);;

     var tilez = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(mymap);

//    mymap.locate({setView: true, maxZoom: 16});

    function onEachFeature(feature, layer) {

        layer.bindPopup(feature.properties.name);
    }


    var mappa = L.geoJson(geoj, {onEachFeature : onEachFeature}
    ).addTo(mymap);

    var bounds = mappa.getBounds();
    mymap.fitBounds(bounds);

//    function onLocationFound(e) {
//            var radius = e.accuracy / 2;
//
//            L.circle(e.latlng, radius).addTo(mymap).bindPopup("You are within " + radius + " meters from this point").openPopup();
//        }
//
//    mymap.on('locationfound', onLocationFound);

</script>

</body>



